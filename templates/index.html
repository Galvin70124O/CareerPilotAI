<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CareerPilot AI</title>
    <link href="https://fonts.googleapis.com/css?family=Inter:400,500,600,700|Roboto+Slab:500,700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
      :root {
        --dark-bg: #18191b;
        --card-bg: #21232a;
        --input-bg: #191a1f;
        --border: #33353c;
        --header: #f5f7fa;
        --bright-blue: #44aaff;
        --blue-glow: #1ecfff;
        --blue-fg: #26a6ff;
        --text: #f4faff;
        --label: #99ceff;
        --subtle: #b9bfd0;
      }
      body {
        background: var(--dark-bg);
        min-height: 100vh;
        font-family: 'Inter', 'Roboto', sans-serif;
        color: var(--text);
      }
      .cp-container {
        max-width: 600px;
        margin: 64px auto 24px auto;
        background: var(--card-bg);
        border-radius: 18px;
        box-shadow: 0 6px 34px #1118;
        padding: 38px 36px 34px 36px;
        border: 1.4px solid var(--border);
      }
      .cp-header {
        font-family: 'Roboto Slab', serif;
        font-weight: 700;
        font-size: 2.08em;
        margin-bottom: 0;
        color: var(--header);
        letter-spacing: -1.2px;
        text-align: center;
      }
      .cp-desc {
        color: var(--subtle);
        font-size: 1.1em;
        text-align: center;
        margin-bottom: 10px;
        font-family: 'Inter', sans-serif;
      }
      .cp-form {
        display: flex;
        flex-direction: column;
        gap: 14px;
        margin-top: 12px;
      }
      label.cp-label {
        color: var(--label);
        font-weight: 500;
        font-size: 1em;
      }
      .cp-textarea {
        background: var(--input-bg);
        color: var(--text);
        border: 1.3px solid var(--border);
        border-radius: 10px;
        min-height: 88px;
        font-size: 1.08em;
        font-family: inherit;
        padding: 12px 13px;
        resize: vertical;
      }
      .form-control[type=file] {
        background: var(--card-bg);
        color: #c7daf7;
        border: 1.1px solid var(--border);
      }
      .cp-btn {
        background: var(--bright-blue);
        color: #fff !important;
        font-size: 1.09em;
        font-weight: 600;
        padding: 10px 0;
        border: none;
        border-radius: 9px;
        margin-top: 2px;
        margin-bottom: 6px;
        letter-spacing: .04em;
        box-shadow: 0 2.5px 22px #29a6fc66;
        transition: background .16s, color .16s, box-shadow .17s;
      }
      .cp-btn:hover, .cp-btn:focus {
        background: var(--blue-glow);
        color: #fff !important;
        box-shadow: 0 0 16px var(--blue-glow);
      }
      .btn-outline-secondary {
        border: 1.3px solid #aaa !important;
        color: #cff !important;
        background: transparent !important;
      }
      .btn-outline-secondary:hover, .btn-outline-secondary:focus {
        border: 1.4px solid var(--bright-blue) !important;
        background: #161b23 !important;
        color: var(--bright-blue) !important;
      }
      .cp-bot-message {
        background: #181b1f;
        border-radius: 12px;
        padding: 18px 21px;
        box-shadow: 0 1.5px 8px #10101419;
        border: 1px solid var(--border);
        font-size: 1.14em;
        color: var(--text);
        margin: 15px 0 0 0;
        word-break: break-word;
      }
      .cp-jobs-title {
        color: var(--subtle);
        font-size: 1.04em;
        font-weight: 600;
        margin-bottom: 7px;
        margin-top: 13px;
      }
      .list-group.cp-jobs-list {
        border: none;
        margin-bottom: 0;
        background: none;
      }
      .cp-jobs-list .list-group-item {
        background: #232328;
        border: none;
        padding: 13px 6px 9px 6px;
        border-bottom: 1px solid #242428;
        color: var(--header);
      }
      .cp-jobs-list .list-group-item:last-child {
        border-bottom: none;
      }
      .cp-jobs-list b {
        color: var(--bright-blue);
        font-weight: 700;
      }
      a.cp-job-link {
        color: var(--blue-fg);
        font-weight: 600;
        text-decoration: underline;
      }
      #micIndicator.glow-bar {
        display:inline-block;
        min-width: 120px;
        height: 32px;
        background: #1b1c23;
        color: #f6fcff;
        font-weight: 630;
        border-radius: 32px;
        border: 2px solid var(--bright-blue);
        text-align: center;
        line-height: 31px;
        letter-spacing: .03em;
        box-shadow: 0 0 9px var(--blue-glow), 0 0 13px #38a8fe91;
        margin-left: 12px;
        padding: 0 19px;
        font-size:1.14em;
        position:relative;
        overflow:hidden;
        transition: background .25s, color .3s, box-shadow .37s, border .19s;
      }
      #micIndicator.glow-bar.active {
        background: #212d46;
        border-color: var(--bright-blue);
        color: #6ecfff;
        box-shadow: 0 0 21px #38baffb8, 0 0 37px #44aaff99;
      }
      #micIndicator.glow-bar.loud {
        animation: blinkGlow .17s alternate 3;
        background: #0a1c41;
        color: #fff;
        border-color: #fff;
        box-shadow: 0 0 31px #44aaffcc, 0 0 45px #1da5ff88;
      }
      @keyframes blinkGlow {
        from { box-shadow: 0 0 19px #33baff, 0 0 26px #29e1ff98;}
        to   { box-shadow: 0 0 7px #0091ff53, 0 0 12px #3f6;}
      }
      .alert-danger { color: #fff; background: #aa2d2f; border: none; }
      @media (max-width: 800px) {
        .cp-container { max-width:99vw; padding:22px 2vw 28px 2vw;}
      }
    </style>
</head>
<body>
  <div class="cp-container">
    <div class="cp-header">CareerPilot AI</div>
    <div class="cp-desc">
      Discover tailored career paths instantly.<br>
      Paste, speak, or upload your skills/resume‚Äîthe AI does the rest.
    </div>
    <form method="POST" enctype="multipart/form-data" class="cp-form">
      <div>
        <label class="cp-label" for="resume_file">Attach resume (.txt, .pdf, .docx, ‚â§2MB)</label>
        <input type="file" class="form-control" id="resume_file" name="resume_file" accept=".txt,.pdf,.docx">
        {% if file_error %}
          <div class="alert alert-danger py-1 px-2 mt-1">{{ file_error }}</div>
        {% endif %}
      </div>
      <textarea class="cp-textarea" id="input_text" name="input_text"
        placeholder="Type, speak, or paste your skills, or extract directly from resume...">{{ skills_text }}</textarea>
      <div>
        <button type="button" class="cp-btn" style="width:32%;" onclick="startDictation()" id="micButton">üé§ Speak</button>
        <span id="micIndicator" class="glow-bar" style="display: none;"><b>‚óè Listening</b></span>
        <button type="submit" class="cp-btn" style="width:32%;background:var(--blue-fg);box-shadow:0 2.5px 9px #1da5ff78;" name="action" value="predict">Send</button>
        <button type="submit" class="cp-btn btn-outline-secondary" style="width:32%;" name="action" value="extract">Extract Skills</button>
      </div>
    </form>
    {% if prediction %}
      <div class="cp-bot-message">
        <b>Recommended Career Path:&nbsp;</b> {{ prediction }}
      </div>
    {% endif %}
    {% if job_results and prediction %}
      <div class="cp-jobs-title">Live Job Listings</div>
      <ul class="list-group cp-jobs-list">
        {% for job in job_results %}
          <li class="list-group-item">
            <b>{{ job.title }}</b> at <span>{{ job.company }}</span>
            <div style="font-size:0.99em; color:#d1d8ff;">
              üìç{{ job.location }}<br>
              <a class="cp-job-link" href="{{ job.url }}" target="_blank">Apply/View ‚Üó</a>
            </div>
          </li>
        {% endfor %}
      </ul>
    {% endif %}
  </div>
  <script>
let audioContext, analyser, microphone, animationId;

function startDictation() {
    var indicator = document.getElementById("micIndicator");
    indicator.style.display = "inline-block";
    indicator.classList.add('active');
    indicator.classList.remove('loud');

    // Live glow/blink on loud
    if (navigator.mediaDevices && window.AudioContext && !window.hasOwnProperty('__NOAUDIO')) {
      navigator.mediaDevices.getUserMedia({audio:true}).then(function(stream){
        audioContext = new (window.AudioContext || window.webkitAudioContext)();
        microphone = audioContext.createMediaStreamSource(stream);
        analyser = audioContext.createAnalyser();
        analyser.fftSize = 512;
        microphone.connect(analyser);

        function monitorLoudness() {
          let bufferLength = analyser.fftSize;
          let dataArray = new Uint8Array(bufferLength);
          analyser.getByteTimeDomainData(dataArray);
          let max = Math.max.apply(null,dataArray), min = Math.min.apply(null,dataArray);
          if (Math.abs(max-128) > 22 || Math.abs(min-128)>22) {
            indicator.classList.add('loud');
            setTimeout(()=>indicator.classList.remove('loud'),130);
          }
          animationId = requestAnimationFrame(monitorLoudness);
        }
        monitorLoudness();
      });
    }

    if (window.hasOwnProperty('webkitSpeechRecognition')) {
        var recognition = new webkitSpeechRecognition();
        recognition.continuous = false;
        recognition.interimResults = false;
        recognition.lang = "en-US";
        recognition.start();
        recognition.onresult = function(event) {
            indicator.classList.remove('active','loud');
            indicator.style.display = "none";
            try{
              microphone && microphone.disconnect();
              analyser && analyser.disconnect();
              audioContext && audioContext.close();
              cancelAnimationFrame(animationId);
            }catch{}
            var inputBox = document.getElementById('input_text');
            inputBox.value += (inputBox.value ? ', ' : '') + event.results[0][0].transcript;
            recognition.stop();
        };
        recognition.onerror = function(event) {
            indicator.classList.remove('active','loud');
            indicator.style.display = "none";
            try{
              microphone && microphone.disconnect();
              analyser && analyser.disconnect();
              audioContext && audioContext.close();
              cancelAnimationFrame(animationId);
            }catch{}
            recognition.stop();
        };
        recognition.onend = function() {
            indicator.classList.remove('active','loud');
            indicator.style.display = "none";
            try{
              microphone && microphone.disconnect();
              analyser && analyser.disconnect();
              audioContext && audioContext.close();
              cancelAnimationFrame(animationId);
            }catch{}
        };
    } else {
        alert("Speech Recognition not supported in this browser. Please use Google Chrome.");
    }
}

window.onload = function() {
    if (!window.performance || window.performance.navigation.type === 1) {
        document.getElementById('input_text').value = "";
        var botMsg = document.querySelector('.cp-bot-message');
        if (botMsg) { botMsg.innerHTML = ""; }
        var jobList = document.querySelector('.cp-jobs-list');
        if (jobList) { jobList.innerHTML = ""; }
    }
};
  </script>
</body>
</html>
